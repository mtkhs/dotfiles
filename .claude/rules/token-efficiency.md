# トークン効率化ルール

トークンを無駄にせず効率的にClaudeを使用する方法を定義する。

## プロンプト最適化

### 指示の明確化

以下を明確にする。

- **目的**: 何を達成したいのか
- **期待される結果**: どのような出力を求めているのか
- **制約条件**: 文字数制限、フォーマット、使用技術など
- **前提条件**: 既知の情報、過去の決定事項

### 構造化

- XMLタグでセクションを区切る
- 長いドキュメントはプロンプトの先頭に配置

## ファイル読み込みの最適化

### 段階的な情報取得

**最初から全ファイルを読まない**。以下の順序で段階的に取得する。

1. **概要**: `get_symbols_overview`, `list_dir`でファイル構造を把握
2. **絞り込み**: `find_symbol`, `search_for_pattern`で対象を特定
3. **詳細**: 必要な部分のみ`include_body=true`または`Read`で読む
4. **全体**: （最終手段）どうしても必要な場合のみ

### 並列読み込み

独立したファイルや検索は**必ず並列**で実行する。

## サブエージェントの活用

コンテキストを大量に消費する調査や複雑なタスクは、サブエージェントに委譲する。

### カスタムエージェント

#### tech-research（技術調査）

`.claude/agents/tech-research.md`

**用途**: ライブラリ、フレームワーク、ベストプラクティスの最新情報調査

**使用タイミング**:
- 新しいライブラリの使い方を調べる
- 複数技術の比較検討
- 実装中の技術確認（メインセッションは実装継続）

**メリット**: メインセッションのコンテキスト節約、要約された実用的な情報のみ受け取れる

**並列実行例**:
```
"Redux、Zustand、Jotaiを比較したい"
→ 3つのtech-researchエージェントを並列起動
→ 結果を受け取って比較・決定
```

### 組み込みエージェント

- **Explore**: コードベース探索（quick/medium/very thorough）
- **Plan**: 実装計画・アーキテクチャ検討
- **general-purpose**: 複雑な質問・複数ステップタスク
- **Bash**: Git操作・コマンド実行

### 使用判断基準

- **技術調査**: tech-research
- **ファイル検索が複数回必要**: Explore
- **実装前の設計**: Plan
- **トークン消費が大きい**: 専門エージェントに委譲
- **並列調査**: 複数エージェントを同時起動

## 情報の再利用

### Serena Memoryの活用

調査結果やプロジェクト知識をSerena Memoryに保存して再利用する。

- プロジェクト構造
- 設計決定
- よくある問題と解決策
- コーディング規約

同じ情報を何度も調査する無駄を省く。
